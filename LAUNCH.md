# Пошаговый гайд: как запустить радио

Пошаговая инструкция для запуска AI-радио на Windows (локально) и через Docker.

---

## Шаг 1. Установка Python

1. Скачайте **Python 3.10 или новее**: https://www.python.org/downloads/
2. При установке включите опцию **"Add Python to PATH"**.
3. Проверьте в командной строке (cmd или PowerShell):
   ```bash
   python --version
   ```
   Должно вывести, например: `Python 3.11.x`.

---

## Шаг 2. Установка FFmpeg (рекомендуется)

FFmpeg нужен для микширования музыки с голосом и для генерации тишины, если в папке `music/` пока нет файлов.

1. Скачайте FFmpeg: https://www.gyan.dev/ffmpeg/builds/ (например, **ffmpeg-release-essentials.zip**).
2. Распакуйте архив в папку, например `C:\ffmpeg`.
3. Добавьте папку `C:\ffmpeg\bin` в переменную окружения **PATH**:
   - Поиск Windows → «Переменные среды» → «Изменить системные переменные среды» → «Переменные среды».
   - В «Системные переменные» найдите **Path** → «Изменить» → «Создать» → укажите `C:\ffmpeg\bin` (или ваш путь к `bin`).
   - Сохраните, закройте все окна командной строки и откройте новое.
4. Проверка:
   ```bash
   ffmpeg -version
   ```
   Должна вывести версию FFmpeg.

Без FFmpeg радио тоже запустится: будут работать TTS (озвучка) и поток, но микш «голос + музыка» и тишина между треками — нет.

---

## Шаг 3. Клонирование репозитория

Если проект ещё не скачан:

```bash
git clone https://github.com/Hexttr/radio.git
cd radio
```

Если папка уже есть (например, `c:\Users\User\Desktop\radio`), перейдите в неё:

```bash
cd c:\Users\User\Desktop\radio
```

---

## Шаг 4. Установка зависимостей Python

В папке проекта выполните:

```bash
pip install -r requirements.txt
```

Должны установиться пакеты: `aiohttp`, `feedparser`, `beautifulsoup4`, `groq`, `edge-tts`, `python-dotenv` и др.

---

## Шаг 5. Настройка переменных окружения (опционально)

1. В корне проекта есть файл **`.env`** (если нет — скопируйте `.env.example` в `.env`).
2. Для AI-новостей нужен бесплатный ключ Groq:
   - Зайдите на https://console.groq.com
   - Зарегистрируйтесь и создайте API Key.
   - В `.env` укажите:
     ```
     GROQ_API_KEY=gsk_ваш_ключ_здесь
     ```
3. Остальные переменные в `.env` опциональны (язык, голоса, интервалы). Примеры:
   - `RADIO_LANGUAGE=ru-RU` — русский.
   - `VOICE_NEWS=ru-RU-DmitryNeural` — мужской голос для новостей.
   - `VOICE_WEATHER=ru-RU-SvetlanaNeural` — женский для погоды.
   - `NEWS_INTERVAL=900` — новости каждые 15 минут (в секундах).

Без `GROQ_API_KEY` радио запустится, но вместо сгенерированных новостей будет короткий filler-текст.

---

## Шаг 6. Добавление музыки

1. Создайте папку **`music`** в корне проекта (если её нет).
2. Положите в неё свои треки в форматах: **MP3**, **WAV**, **OGG** или **FLAC**.
3. Имена файлов могут быть любыми.

Если папка `music/` пустая и установлен FFmpeg — между блоками будет тишина. Если FFmpeg нет — в логе будет предупреждение, музыка не будет микшироваться.

---

## Шаг 7. Запуск радио

### Вариант A: двойной клик (Windows)

Запустите файл **`run.bat`** двойным щелчком. Откроется окно консоли, в логах появится строка вида:

```
Listen at: http://localhost:8080/stream
```

### Вариант B: из командной строки

В папке проекта выполните:

```bash
python -m src.radio
```

Остановка: в консоли нажмите **Ctrl+C**.

---

## Шаг 8. Прослушивание

1. Откройте браузер и перейдите по адресу: **http://localhost:8080**
2. На странице будет плеер и название станции — нажмите Play.
3. Прямая ссылка на поток (для плееров по URL): **http://localhost:8080/stream**
4. Статус (очередь, название): **http://localhost:8080/status**

---

## Шаг 9. Проверка, что всё работает

- В консоли нет красных сообщений об ошибках.
- В браузере по адресу http://localhost:8080 воспроизводится звук (джингл, новости или музыка).
- В течение нескольких минут в плейлист добавляются: джингл, приветствие, новости (если указан GROQ_API_KEY), погода, треки из `music/`.

---

## Запуск через Docker

1. Установите [Docker Desktop](https://www.docker.com/products/docker-desktop/).
2. В папке проекта создайте/отредактируйте `.env` (при необходимости укажите `GROQ_API_KEY`).
3. Выполните:
   ```bash
   docker-compose up -d
   ```
4. Откройте в браузере: **http://localhost:8080**
5. Музыку можно подключить томом: положите файлы в папку `music/` на хосте — в `docker-compose.yml` уже смонтирован объём `./music:/app/music`.

Остановка:

```bash
docker-compose down
```

---

## Частые проблемы

| Проблема | Решение |
|----------|--------|
| `python` не найден | Установите Python и добавьте его в PATH (шаг 1). |
| `FFmpeg not found` | Установите FFmpeg и добавьте в PATH (шаг 2) или игнорируйте, если не нужен микш. |
| Нет звука в браузере | Проверьте, что радио запущено и открыт http://localhost:8080 (не 8000). |
| Нет новостей / только filler | Укажите в `.env` корректный `GROQ_API_KEY` (шаг 5). |
| Порт 8080 занят | Смените порт в коде: в `src/radio.py` у `SimpleHTTPStreamer(port=8080)` укажите другой, например `9090`. |

---

## Сохранение прогресса и пуш в GitHub (Hexttr/radio)

Если вы ведёте разработку в своей копии и хотите пушить в https://github.com/Hexttr/radio:

1. Добавьте remote (один раз):
   ```bash
   git remote add hexttr https://github.com/Hexttr/radio.git
   ```
2. Коммит и пуш:
   ```bash
   git add .
   git commit -m "описание изменений"
   git push hexttr main
   ```
   Если ветка по умолчанию у вас другая (например `master`), замените `main` на неё или сначала выполните `git branch -M main`.

Если репозиторий Hexttr/radio уже добавлен как `origin`:

```bash
git add .
git commit -m "описание изменений"
git push -u origin main
```

---

Готово. После выполнения шагов 1–8 радио будет работать локально на вашем компьютере.
